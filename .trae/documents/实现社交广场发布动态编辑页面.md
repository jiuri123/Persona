# 实现社交广场发布动态编辑页面

## 需求分析
用户希望点击社交广场的"+"按钮后，先进入一个编辑页面，而不是直接发布动态。编辑页面需要包含：
- 空白编辑框
- AI扩展按钮：根据当前Persona设定扩展已有内容
- AI生成按钮：根据当前Persona设定生成新内容
- 发布动态按钮：发布编辑好的内容
- 取消发布按钮：返回社交广场

## 实现方案

### 1. 创建新的Activity和ViewModel
- **PostEditorActivity**：发布动态编辑页面
- **PostEditorViewModel**：管理编辑页面的业务逻辑
- **activity_post_editor.xml**：编辑页面的布局文件

### 2. 扩展现有Repository
- 在`UserPersonaPostRepository`中添加两个新方法：
  - `aiExpandContent()`：根据当前Persona扩展已有内容
  - `aiGenerateContent()`：根据当前Persona生成新内容

### 3. 修改现有代码
- 修改`SocialSquareFragment`的"+"按钮点击事件，跳转到`PostEditorActivity`

### 4. 实现页面布局
- 设计美观的编辑页面，包含：
  - 顶部导航栏（标题、取消按钮）
  - 空白编辑框
  - 底部操作按钮（AI扩展、AI生成、发布动态）

### 5. 实现业务逻辑
- **AI扩展**：将编辑框内容发送到AI，按照当前Persona设定扩展
- **AI生成**：直接调用AI生成符合当前Persona设定的内容
- **发布动态**：将编辑框内容作为新帖子发布到社交广场
- **取消发布**：返回社交广场页面

## 技术实现细节

### 1. 页面布局设计
- 使用ConstraintLayout实现响应式布局
- 编辑框使用Material Design风格的TextInputLayout
- 按钮使用Material Design风格的MaterialButton
- 整体配色方案与现有应用保持一致

### 2. MVVM架构实现
- **View**：PostEditorActivity负责UI展示和用户交互
- **ViewModel**：PostEditorViewModel处理业务逻辑，与Repository交互
- **Model**：UserPersonaPostRepository负责数据管理和网络请求

### 3. 网络请求处理
- 复用现有的API客户端和服务
- 为AI扩展和AI生成设计不同的提示词模板
- 处理加载状态和错误信息

### 4. 导航逻辑
- 使用Intent在SocialSquareFragment和PostEditorActivity之间传递数据
- 使用ActivityResultLauncher处理返回结果

## 实现步骤

1. 创建`PostEditorActivity`和对应的布局文件
2. 创建`PostEditorViewModel`
3. 扩展`UserPersonaPostRepository`，添加AI扩展和AI生成方法
4. 修改`SocialSquareFragment`的按钮点击事件
5. 实现PostEditorActivity的UI交互和业务逻辑
6. 测试所有功能，确保正常工作

## 预期效果
- 点击社交广场"+"按钮，进入编辑页面
- AI扩展和AI生成功能正常工作
- 发布动态后，内容显示在社交广场
- 取消发布后，返回社交广场
- 整体UI美观，符合Material Design规范
- 代码结构清晰，符合MVVM架构

## 注意事项
- 确保权限处理正确
- 处理网络请求的加载状态和错误
- 保持代码风格与现有代码一致
- 确保内存管理正确，避免内存泄漏